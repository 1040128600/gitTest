<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-Mapper.dtd"> 
<mapper namespace="dao.RentReturnDao">
<cache-ref namespace="dao.BicycleStationDao"/>

	
	<select id="getOneBicycle" resultType="model.Bicycle_info">
	 select * from Bicycle_info where bicycle_Id=#{bicycle_Id}
	</select>
	<update id="updateBicycle_info" >
   update Bicycle_info set card_Id=#{card_Id} ,pile_Id=#{pile_Id} ,status=#{status} where bicycle_Id=#{bicycle_Id}
	</update>
	
	<select id="getOnePile" resultType="model.Bicycle_pile">
	 select * from Bicycle_pile where pile_Id=#{pile_Id}
	</select>
	<update id="updatePile">
	    update Bicycle_pile set status=#{status},bicycle_Id=#{bicycle_Id} where  pile_Id =#{pile_Id}
	    
	</update>
    
	<select id="getOneCard" resultType="model.Card">
	    select * from Card where card_Code=#{card_Code}
	    
	</select>
	<update id="updateCard">
	    update card set frozen_Money=#{frozen_Money}, wallet_Money=#{wallet_Money} where card_Id=#{card_Id}
	    
	</update>
	
	<insert id="addBicycle_record">
		<selectKey keyProperty="record_Id" resultType="int" order="BEFORE" >
		    select Bicycle_record_seq.nextval from dual   
		</selectKey>
	    insert into Bicycle_record(	
	    record_Id,
	    bicycle_Id,
		card_Id,
		remark,
		rent_Pile_Id,
		rent_Time
		) values(
		#{record_Id},
	    #{bicycle_Id},
		#{card_Id},
		#{remark},
		#{rent_Pile_Id},
		#{rent_Time}
		)
	    
	</insert>
	
	<update id="updateBicycle_record">
	    update Bicycle_record set 
	    return_Pile_Id=#{return_Pile_Id} ,
		return_Time=#{return_Time},
		money=#{money},
		remark=#{remark}
		where record_Id=#{record_Id}
	    
	</update>
	
	<insert id="addBicycle_deal">
	    		<selectKey keyProperty="deal_Id" resultType="int" order="BEFORE" >
		    select Bicycle_deal_seq.nextval from dual   
		</selectKey>
	    insert into Bicycle_deal values(
	    	#{deal_Id},
			#{create_Time},
			#{deal_Name},
			#{deal_Type},
			#{record_Id},
			#{card_Id},
			#{is_Fee},
			#{chg_Money},
			#{fee_Type},
			#{bicycle_Id},
			#{pile_Id},
 			#{user_Id}
	    )
	    
	</insert>
	<insert id="addCard_record">
	    <selectKey keyProperty="record_Id" resultType="int" order="BEFORE">
	        select Card_record_seq.nextVal from dual
	        
	    </selectKey>
	    
	    insert into Card_record values(
	    #{record_Id},
		#{card_Id},
		#{fee_Type},
		#{chg_Monthly_Money},
		#{chg_Wallet_Money},
		#{chg_Frozen_Money},
		#{create_Time},
		#{user_Id},
		#{remark},
		#{zxbj}
	    )
	    
	</insert>
	<select id="ifRented"  resultType="model.Bicycle_record">
	    select * from Bicycle_record where card_Id=#{card_Id} and return_Time is null
	    
	</select>
    
    
</mapper>